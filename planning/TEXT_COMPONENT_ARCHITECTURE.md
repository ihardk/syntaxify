# Text Component Architecture Analysis

## Complete Flow: Meta → Generation → Runtime

### 1️⃣ SOURCE: Meta File (User Creates)
**Location:** `/generator/meta/text.meta.dart`

```dart
@SyntaxComponent(
  description: 'A customizable text component',
  variants: ['displayLarge', 'headlineMedium', 'titleMedium', 'bodyLarge',
             'bodyMedium', 'labelMedium', 'labelSmall'],
)
class TextMeta {
  @Required()
  final String text;

  @Optional()
  final TextVariant? variant;  // References enum that will be GENERATED
  // ... other props
}
```

**Key point:** `variants: [...]` array drives GENERATION of TextVariant enum

---

### 2️⃣ GENERATED: Variant Enum (Auto-Generated from Meta)
**Location:** `lib/syntaxify/generated/variants/text_variant.dart`

```dart
// GENERATED CODE - DO NOT MODIFY BY HAND
// Generated by Syntaxify EnumGenerator

enum TextVariant {
  displayLarge,
  headlineMedium,
  titleMedium,
  bodyLarge,
  bodyMedium,
  labelMedium,
  labelSmall,
}
```

**Generated by:** `EnumGenerator.generate('Text', ['displayLarge', ...])`
**Source:** Meta file `@SyntaxComponent(variants: [...])`
**When:** During `syntaxify build`

---

### 3️⃣ TEMPLATE: Token File (Shipped with Generator)
**Template location:** `/generator/design_system/tokens/text_tokens.dart`

```dart
import 'foundation/foundation_tokens.dart';
import '../variants/text_variant.dart';  // ← WRONG PATH (template expects manual)

class TextTokens {
  final TextStyle style;
  final Color color;
  // ... properties

  factory TextTokens.fromFoundation(
    FoundationTokens foundation, {
    required TextVariant variant,
  }) {
    switch (variant) {
      case TextVariant.displayLarge:
        baseStyle = foundation.displayLarge;  // ← Uses foundation tokens!
      // ... other cases
    }

    return TextTokens(
      style: baseStyle.copyWith(color: foundation.colorOnSurface),
      color: foundation.colorOnSurface,
      // ...
    );
  }
}
```

**Copied to:** `lib/syntaxify/design_system/tokens/text_tokens.dart`
**Import updated to:** `import '../../generated/variants/text_variant.dart';`

**Flow:** Foundation tokens → Component tokens via `.fromFoundation()`

---

### 4️⃣ TEMPLATE: Renderers (Shipped with Generator)
**Template location:** `/generator/design_system/components/text/material_renderer.dart`

```dart
part of '../../design_system.dart';

mixin MaterialTextRenderer on DesignStyle {
  @override
  TextTokens textTokens(TextVariant variant) {
    return TextTokens.fromFoundation(foundation, variant: variant);
  }

  @override
  Widget renderText({
    required String text,
    TextVariant? variant,
    // ...
  }) {
    final effectiveVariant = variant ?? TextVariant.bodyMedium;
    final tokens = textTokens(effectiveVariant);  // Get tokens from foundation

    return Text(
      text,
      style: tokens.style.copyWith(
        color: tokens.color,
        letterSpacing: tokens.letterSpacing,
      ),
      // ...
    );
  }
}
```

**Copied to:** `lib/syntaxify/design_system/components/text/material_renderer.dart`
**Also copied:** `cupertino_renderer.dart`, `neo_renderer.dart`

**This is the KEY difference from custom components:**
- Custom components: STUBS are generated (user implements)
- Standard components: FULL IMPLEMENTATIONS are copied (we provide)

---

### 5️⃣ GENERATED: AppText Component (Auto-Generated)
**Location:** `lib/syntaxify/generated/components/app_text.dart`

```dart
// GENERATED BY SYNTAXIFY
class AppText extends StatelessWidget {
  const AppText({
    required this.text,
    this.variant,
    // ...
  });

  // Named constructors for each variant (auto-generated!)
  const AppText.displayLarge({required this.text, ...})
      : variant = TextVariant.displayLarge;

  const AppText.headlineMedium({required this.text, ...})
      : variant = TextVariant.headlineMedium;

  // ... 7 total named constructors from variants array

  @override
  Widget build(BuildContext context) {
    return AppTheme.of(context).style.renderText(
      text: text,
      variant: variant,
      // ...
    );
  }
}
```

**Generated by:** `ComponentGenerator`
**Named constructors:** Auto-generated from `variants: [...]` array in meta

---

### 6️⃣ FOUNDATION: Foundation Tokens (Shipped with Generator)
**Location:** `/generator/design_system/tokens/foundation/foundation_tokens.dart`

```dart
class FoundationTokens {
  // Typography scale (Material Design 3)
  final TextStyle displayLarge;   // 57sp
  final TextStyle headlineMedium; // 28sp
  final TextStyle bodyMedium;     // 14sp
  final TextStyle labelSmall;     // 11sp
  // ...

  // Color system
  final Color colorOnSurface;
  final Color colorPrimary;
  // ...
}
```

**Implementations:**
- `material_foundation.dart` - Material Design 3 values
- `cupertino_foundation.dart` - iOS design values
- `neo_foundation.dart` - Custom bold design

**These provide the actual values** that TextTokens.fromFoundation() uses.

---

## Complete Flow Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│ DESIGN TIME (Developer Creates)                                 │
└─────────────────────────────────────────────────────────────────┘

1. Developer creates: meta/text.meta.dart
   @SyntaxComponent(variants: ['displayLarge', 'bodyMedium', ...])

                            ↓

┌─────────────────────────────────────────────────────────────────┐
│ BUILD TIME (`syntaxify build`)                                  │
└─────────────────────────────────────────────────────────────────┘

2. EnumGenerator reads meta file
   ↓
   Generates: generated/variants/text_variant.dart
   enum TextVariant { displayLarge, bodyMedium, ... }

3. Copy from template: design_system/tokens/text_tokens.dart
   ↓
   Update import: '../variants/' → '../../generated/variants/'
   ↓
   Copied to: lib/syntaxify/design_system/tokens/text_tokens.dart

4. Copy from template: components/text/*_renderer.dart (3 files)
   ↓
   Copied to: lib/syntaxify/design_system/components/text/
   - material_renderer.dart (FULL IMPLEMENTATION)
   - cupertino_renderer.dart (FULL IMPLEMENTATION)
   - neo_renderer.dart (FULL IMPLEMENTATION)

5. ComponentGenerator creates: generated/components/app_text.dart
   ↓
   Generates 7 named constructors from variants array
   AppText.displayLarge(), AppText.bodyMedium(), ...

6. Copy foundation tokens: tokens/foundation/*.dart
   ↓
   Copied to: lib/syntaxify/design_system/tokens/foundation/

                            ↓

┌─────────────────────────────────────────────────────────────────┐
│ RUNTIME (User App Executes)                                     │
└─────────────────────────────────────────────────────────────────┘

User writes:
  AppText.bodyMedium(text: 'Hello')

↓ build() called

AppTheme.of(context).style.renderText(
  text: 'Hello',
  variant: TextVariant.bodyMedium,
)

↓ style is MaterialStyle

MaterialTextRenderer.renderText()
  ↓ calls
  textTokens(TextVariant.bodyMedium)
    ↓ calls
    TextTokens.fromFoundation(foundation, variant: bodyMedium)
      ↓ reads
      foundation.bodyMedium (TextStyle 14sp from material_foundation.dart)
      ↓ returns
      TextTokens(style: 14sp TextStyle, color: colorOnSurface, ...)

  ↓ renders

  Text('Hello', style: tokens.style)
```

---

## Key Architectural Points

### What Comes FROM Generator Package (Templates)

1. ✅ **Token files** (with variant imports updated)
   - `text_tokens.dart` - Copied, imports fixed

2. ✅ **Renderer files** (FULL implementations for standard components)
   - `material_renderer.dart` - Copied as-is
   - `cupertino_renderer.dart` - Copied as-is
   - `neo_renderer.dart` - Copied as-is

3. ✅ **Foundation tokens** (design system primitives)
   - `foundation_tokens.dart` - Class definition
   - `material_foundation.dart` - Material values
   - `cupertino_foundation.dart` - iOS values
   - `neo_foundation.dart` - Custom values

### What Is GENERATED (Not in generator package)

1. ✅ **Variant enums** - From meta file `variants: [...]` array
   - `generated/variants/text_variant.dart`

2. ✅ **Component wrappers** - From meta file properties
   - `generated/components/app_text.dart`
   - Named constructors auto-generated from variants

3. ✅ **Integration files** - Imports/exports/mixins
   - `design_system.dart` - Imports variants, tokens, renderers
   - `design_style.dart` - Abstract render methods
   - `material_style.dart` - Mixes in renderers

---

## Standard vs Custom Components

### Standard Components (Text, Button, Card, etc.)

```
Meta file
  ↓
GENERATES: Variant enum
COPIES: Token file (full implementation)
COPIES: Renderers (FULL implementations - we provide the rendering logic)
GENERATES: Component wrapper
```

**We provide:** The actual rendering code (how to use Material widgets)

### Custom Components (e.g., SuperCard)

```
Meta file
  ↓
GENERATES: Variant enum
GENERATES: Token file (stub)
GENERATES: Renderers (STUBS - "// TODO: Implement me!")
GENERATES: Component wrapper
```

**User provides:** The rendering code (they implement the stubs)

---

## The Import Path Issue (Current Problem)

### Template Files (in generator package)

```dart
// generator/design_system/tokens/text_tokens.dart
import '../variants/text_variant.dart';  // ❌ Expects manual variants/
```

**Problem:** `variants/` directory doesn't exist in generator package (was deleted)

### Generated Files (in user project)

```dart
// lib/syntaxify/design_system/tokens/text_tokens.dart
import '../../generated/variants/text_variant.dart';  // ✅ Correct!
```

**Solution:** Import path is UPDATED during copy to point to generated variants

---

## What Should Happen

### Generator Package Structure

```
generator/
├── meta/
│   └── text.meta.dart                     # Source of truth
├── design_system/                         # TEMPLATES (copied to user projects)
│   ├── tokens/
│   │   └── text_tokens.dart              # Import path WILL BE UPDATED on copy
│   ├── components/text/
│   │   ├── material_renderer.dart        # Full implementation (copied as-is)
│   │   ├── cupertino_renderer.dart
│   │   └── neo_renderer.dart
│   └── (NO variants/ directory!)         # Variants are GENERATED, not templated
```

### User Project After Build

```
lib/syntaxify/
├── generated/                             # AUTO-GENERATED
│   ├── variants/
│   │   └── text_variant.dart             # ← Generated from meta variants: []
│   └── components/
│       └── app_text.dart                  # ← Generated from meta
├── design_system/                         # COPIED from templates
│   ├── tokens/
│   │   └── text_tokens.dart              # Import updated: '../../generated/variants/'
│   └── components/text/
│       ├── material_renderer.dart        # Copied as-is
│       ├── cupertino_renderer.dart
│       └── neo_renderer.dart
```

---

## Foundation Token Flow

```
FoundationTokens (abstract definition)
  ↓
MaterialFoundation (provides Material Design 3 values)
  ↓
foundation.bodyMedium = TextStyle(fontSize: 14, fontWeight: normal, ...)
  ↓
TextTokens.fromFoundation(foundation, variant: bodyMedium)
  ↓
Returns: TextTokens(
  style: TextStyle(fontSize: 14, color: colorOnSurface),
  color: colorOnSurface,
  fontSize: 14,
  ...
)
  ↓
MaterialTextRenderer.renderText() uses tokens
  ↓
Text widget with style
```

**Key insight:** Foundation tokens are the "design system primitives" that ALL component tokens derive from.

---

## Summary

### What Makes Text Component Work

1. **Meta file** defines variants array → drives enum generation
2. **EnumGenerator** creates TextVariant enum from variants array
3. **Token file** maps variants to foundation tokens
4. **Renderers** (we provide full implementations) use tokens to render
5. **Component wrapper** (generated) delegates to style.renderText()
6. **Foundation tokens** provide actual design values (colors, typography, spacing)

### The "UI Compiler" Principle

- ✅ Variants: **GENERATED** from meta `variants: []` array
- ✅ Component: **GENERATED** from meta properties
- ✅ Integration: **GENERATED** (imports, exports, mixins)
- ✅ Tokens: **COPIED template** (updated imports)
- ✅ Renderers: **COPIED template** (full implementations for standard, stubs for custom)

**Everything driven by meta files.** The difference between standard and custom components is:
- **Standard:** We ship the renderer implementations
- **Custom:** User implements the renderer stubs
